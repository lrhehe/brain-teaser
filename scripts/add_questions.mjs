#!/usr/bin/env node

/**
 * Script to add scraped brain teaser questions to questions.json
 * Generates 3-choice options with randomized correct answer position
 */
import { readFileSync, writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const questionsPath = join(__dirname, '..', 'src', 'data', 'questions.json');

// Raw scraped Q&A pairs from bmcx.com
const rawData = [
    // === Round 1: Recommendations ===
    { q: "每天早上从东方升起，西方落下，猜一种五个字的东西？", a: "是是是太阳", w: ["向日葵", "月亮"] },
    { q: "曹兰在马路边拦下一辆计程车，当她坐进车中后立刻被司机赶出来，为什么？", a: "她说不告诉你去哪", w: ["她没带钱", "车坏了"] },
    { q: "牛小时侯叫\u201c犊\u201d那兔子、乌龟小时侯应如何称呼？", a: "兔崽子龟儿子", w: ["小兔小龟", "兔仔龟仔"] },
    { q: "小陈半夜吃泡面，为什么一面吃一面眼盯着表？", a: "那包面的食用期到今天", w: ["怕迟到", "在计时"] },
    { q: "为什么老陈会说他少了女人一天也活不下去？", a: "他是化妆品制造商", w: ["他很浪漫", "他需要护士照顾"] },
    { q: "报纸新闻和电视新闻最大的不同在哪里？", a: "报纸看完了可以保存", w: ["一个有图一个没图", "速度不同"] },
    { q: "有架飞机失事，现场支离破碎，令人惊讶的是找不到任何伤者，为什么？", a: "那是一架遥控飞机", w: ["乘客都跳伞了", "飞机是空的"] },
    { q: "老张不小心吞了一枚金币，为什么到十年后才去手术取出来呢？", a: "因为当时不急着用钱", w: ["他怕疼", "医生不在"] },
    { q: "天黑一次亮一次就是一天，可有一次天黑了两次仍然只过了一天，为什么？", a: "碰上日全食了", w: ["停电了", "在南极"] },
    { q: "有一个人发高烧50度，他这时该找谁帮忙？", a: "消防队", w: ["医生", "护士"] },
    { q: "小明在图画课交了一张全部涂黑的图画，为什么老师还算及格？", a: "他画的是黑人在半夜里抓乌鸦", w: ["老师看错了", "那是抽象画"] },
    { q: "一人一点是什么字？", a: "太", w: ["大", "犬"] },
    { q: "山岗上有三只狐狸，猎人开枪打死了一只，问山岗上还有几只狐狸？", a: "一只", w: ["两只", "没有了"] },
    { q: "一只羊碰到一头老虎，非但不怕，而且还把那头老虎给吃了，为什么？", a: "那是只纸老虎", w: ["羊比老虎大", "老虎是假的标本"] },
    { q: "人们心中最热烈最难以满足的激情之一是什么？", a: "好奇心", w: ["爱情", "金钱欲望"] },

    // === Round 2: Animal themed ===
    { q: "家有家规，国有国规，那动物园里有啥规？", a: "乌龟", w: ["园规", "动物规则"] },
    { q: "有种动物，大小像只猫，长相又像虎，这是什么动物？", a: "小老虎", w: ["猫科动物", "豹猫"] },
    { q: "什么动物在天上是4只脚，在地上是2只脚，在水里是3只脚？", a: "怪物", w: ["青蛙", "鸭子"] },
    { q: "动物园里，小明紧挨着老虎合影留念，老虎却没有咬他，为什么？", a: "那是只假老虎", w: ["老虎被关着", "老虎吃饱了"] },
    { q: "哪一种动物，虽说是金，却不是真，大眼孩儿，爱穿长裙？", a: "金鱼", w: ["金丝猴", "金龟子"] },
    { q: "动物园中，大象鼻子最长，鼻子第二长的是什么？", a: "小象", w: ["长颈鹿", "犀牛"] },
    { q: "如果动物园失火了，最先逃出来的哪一种动物？", a: "人", w: ["猴子", "兔子"] },
    { q: "恐龙为什么会灭亡？", a: "那个时候没有动物保护协会", w: ["小行星撞地球", "气候变化"] },
    { q: "恐龙为什么会灭亡？", a: "那个时候没有动物保护协会", w: ["小行星撞地球", "气候变化"] },
    { q: "恐龙为什么会灭亡？", a: "那个时候没有动物保护协会", w: ["小行星撞地球", "气候变化"] },
    { q: "武松到底犯了什么罪，为何被抓？", a: "打死保护动物老虎", w: ["醉酒闹事", "杀人"] },
    { q: "什么动物即没有祖先又没有子孙？", a: "骡子", w: ["熊猫", "独角兽"] },
    { q: "进动物园后，最先看到的是哪种动物？", a: "人", w: ["猴子", "大象"] },
    { q: "什么动物坐也是坐，站也是坐，走也是坐？", a: "青蛙", w: ["蛇", "企鹅"] },
    { q: "何种动物最接近于人类？", a: "寄生在人身体上的寄生虫", w: ["猩猩", "猴子"] },
    { q: "北极里有一种动物，背上有两个峰四只脚，猜一种五个字的动物？", a: "迷失的骆驼", w: ["北极熊宝宝", "双峰企鹅"] },
    { q: "什么动物天天熬夜？", a: "熊猫，你看它的黑眼圈", w: ["猫头鹰", "蝙蝠"] },
    { q: "动物园里有一只可爱的熊猫，为什么人们都不敢接近它？", a: "油漆未干", w: ["它会咬人", "正在吃东西"] },

    // === Round 3: "什么" series ===
    { q: "一个男人加一个女人会成了什么？", a: "两个人", w: ["夫妻", "一家人"] },
    { q: "你能做、我能做、大家都能做，一个人能做、两个人不能一起做。这是做什么？", a: "做梦", w: ["打喷嚏", "独自思考"] },
    { q: "什么时候4-3=5？", a: "算错时", w: ["数学里不可能", "用罗马数字时"] },
    { q: "什么东西打破了才能吃？", a: "鸡蛋", w: ["核桃", "西瓜"] },
    { q: "让病人出一身大汗的妙方是什么？", a: "当着病人的面把补药全吃掉", w: ["多运动", "蒸桑拿"] },
    { q: "有一样东西不管你喜欢与否，它却每年一定要增加一点，这是什么？", a: "年龄", w: ["体重", "皱纹"] },
    { q: "什么东西装玻璃，爱把鼻子当马骑？", a: "眼镜", w: ["鱼缸", "花瓶"] },
    { q: "大象的左耳朵像什么？", a: "右耳朵", w: ["扇子", "树叶"] },
    { q: "把火熄灭最快的方法是什么？", a: "给火字加上一横", w: ["用水浇", "用灭火器"] },
    { q: "如果你要想使梦成为现实首先要做什么？", a: "醒来", w: ["努力工作", "做计划"] },
    { q: "贝多芬给了学生什么样的启示？", a: "背了课本就会多得分", w: ["音乐改变人生", "坚持不放弃"] },
    { q: "什么东西经常会来，但却从没真正来过？", a: "明天", w: ["好运", "外星人"] },
    { q: "报纸上登的消息不一定百分之百是真的，但什么消息绝对假不了？", a: "日期", w: ["天气预报", "广告"] },
    { q: "既没有生孩子也没有认干娘，却先当上了娘，这是什么人？", a: "新娘", w: ["养母", "继母"] },
    { q: "什么时候我们会目中无人？", a: "半夜一个人走在墓地时", w: ["戴墨镜时", "闭上眼时"] },

    // === Round 4: "为什么" series ===
    { q: "为什么人们要到市场上去？", a: "因为市场不会过来", w: ["因为要买东西", "因为要逛街"] },
    { q: "为什么先看见闪电后听到雷声？", a: "因为眼睛在前耳朵在后", w: ["光速比声速快", "闪电离得近"] },
    { q: "为什么流氓坐车不要钱？", a: "因为那是囚车", w: ["他是司机", "他偷偷逃票"] },
    { q: "为什么青蛙可以跳得比树高？", a: "因为树不会跳", w: ["青蛙腿很有力", "树不高"] },
    { q: "为什么婴儿一出生就大哭？", a: "他看到护士阿姨太漂亮觉得自己太小", w: ["因为冷", "因为饿了"] },
    { q: "为什么阿福总要等老师动手才去听老师的话？", a: "他是个聋子", w: ["他调皮", "他叛逆"] },
    { q: "为什么拿破仑的字典里没有难字？", a: "因为他的字典是法文的", w: ["他意志坚强", "他没有字典"] },
    { q: "为什么刘备三顾茅庐诸葛亮才肯见他？", a: "因为前两次没带礼", w: ["诸葛亮不在家", "在考验诚意"] },
    { q: "为什么老王家的马能吃掉老张家的象？", a: "他们在下象棋", w: ["马很凶猛", "象生病了"] },
    { q: "为什么警察要系白皮带？", a: "不系皮带裤子会掉下来", w: ["是制服规定", "为了好看"] },
    { q: "为什么冲天炮射不到星星？", a: "因为星星会闪", w: ["因为太远了", "因为炮太弱"] },
    { q: "为什么离婚的人越来越多？", a: "因为结婚的越来越多", w: ["因为社会压力", "因为不够相爱"] },
    { q: "为什么穿高跟鞋的女人快结婚了？", a: "穿高跟鞋走得慢容易被男人追上", w: ["高跟鞋代表成熟", "这是一种暗示"] },

    // === Round 5: "谁" series ===
    { q: "你的阿姨有个姐姐，但你不叫她阿姨，她是谁？", a: "妈妈", w: ["奶奶", "阿姨的朋友"] },
    { q: "谁会连续摇头半个小时以上？", a: "看球赛的人", w: ["摇头娃娃", "风扇"] },
    { q: "除了司机，还有谁可以每天搭公车而不必给钱？", a: "售票员", w: ["小孩", "老人"] },
    { q: "谁是世界上最有恒心的画家？", a: "爱化妆的女人", w: ["达芬奇", "毕加索"] },
    { q: "泰山是人猿养大的，蝙蝠侠是谁养大的？", a: "他的爸爸妈妈", w: ["蝙蝠养大的", "管家养大的"] },
    { q: "谁经常买鞋自己不穿却给别人穿？", a: "卖鞋的人", w: ["妈妈", "设计师"] },
    { q: "老虎的弟弟是谁？", a: "猫", w: ["小老虎", "豹子"] },
    { q: "第一个登上月球的中国姑娘是谁？", a: "嫦娥", w: ["王亚平", "刘洋"] },
    { q: "米的外公是谁？", a: "爆米花（抱过米也抱过花）", w: ["大米", "稻子"] },
    { q: "米的爸爸是谁？", a: "蝶（蝶恋花）", w: ["稻谷", "农夫"] },
    { q: "谁说话的声音传得最远？", a: "打电话的人", w: ["歌手", "播音员"] },

    // === Round 6: "哪" series ===
    { q: "哪一种草的生命力最强？", a: "墙头草", w: ["仙人掌", "杂草"] },
    { q: "蚂蚁、蜜蜂和蜈蚣，哪一种昆虫最不贪钱？", a: "蜈蚣（无功不受禄）", w: ["蚂蚁", "蜜蜂"] },
    { q: "哪一种竹子不长在土里？", a: "爆竹", w: ["熊猫竹", "水竹"] },
    { q: "哪种火车车厢最少？", a: "救火车", w: ["地铁", "货运火车"] },
    { q: "哪儿的海不产鱼？", a: "辞海", w: ["死海", "里海"] },
    { q: "哪一件衣服最耐穿？", a: "最不喜欢的那件", w: ["牛仔衣", "皮衣"] },
    { q: "太阳和月亮在一起是哪一天？", a: "明天", w: ["日食那天", "月食那天"] },
    { q: "一辆汽车过90度弯时，哪个轮子一定离开地面？", a: "备用轮胎", w: ["左前轮", "右后轮"] },
    { q: "哪种报刊发行量最少？", a: "电报", w: ["学术杂志", "内部刊物"] },
    { q: "金钟奖、金马奖、金像奖哪个对国家贡献最大？", a: "金钟奖（精忠报国）", w: ["金马奖", "金像奖"] },
    { q: "实行减肥时，最容易瘦的是哪一个部位？", a: "钱包", w: ["肚子", "大腿"] },
    { q: "哪一个月有28天？", a: "每个月都有", w: ["二月", "只有闰年的二月"] },
    { q: "哪家人最多？", a: "国家", w: ["大户人家", "幼儿园"] },

    // === Additional high-quality ones ===
    { q: "小华和小涵约好中午12点在学校吃饭，小华看了表后匆匆去找小涵，小涵说你相信9+4=1吗？为什么？", a: "九点钟加四点钟是一点钟", w: ["小涵在开玩笑", "算术题"] },
    { q: "有个男子住在十三楼，他每天出门必搭电梯到一楼，但回来时只搭到四楼然后再爬楼上去，为什么？", a: "他个子太矮按不到按钮", w: ["他喜欢锻炼", "电梯坏了"] },
    { q: "我有九个苹果，却必须分给十三个小朋友，我该怎么办？", a: "榨果汁", w: ["再去买几个", "每人分一点"] },
    { q: "怀孕的母狗怕人踢它，可是有个家伙踢它，它既不躲避也不生气，为什么？", a: "因为那家伙在它的肚子里踢", w: ["那是它的主人", "它睡着了"] },
    { q: "我伯父的弟媳，但不是我的叔母，那她是谁？", a: "我母亲", w: ["我姑姑", "我舅妈"] },
    { q: "小明到动物园玩，看到一只大黑熊，很高兴地摸摸它，但那只大黑熊一点也不生气，为什么？", a: "那只大黑熊是个标本", w: ["黑熊性格温顺", "黑熊在睡觉"] },
    { q: "在动物园里，最先看见的是什么关在笼子里的动物？", a: "售票员", w: ["猴子", "老虎"] },
];

// Type classification keywords
function classifyType(question) {
    if (/动物|老虎|蛇|鸟|狗|猫|鸡|鱼|熊|蚊|虫|龙|兔|龟|狐|象|鸭|老鼠|猴|蛙|蜈蚣|蚂蚁|蜜蜂/.test(question)) return 'animal';
    if (/几|多少|加|减|等于|\d+[+\-×÷=]|数字|算/.test(question)) return 'math';
    if (/为什么|怎么|如何|逻辑/.test(question)) return 'logic';
    return 'daily';
}

// Shuffle array
function shuffle(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

// Load existing questions
const existing = JSON.parse(readFileSync(questionsPath, 'utf8'));
const existingTexts = new Set(existing.map(q => q.text.replace(/[？?！!。，,\s]/g, '')));

console.log(`Existing questions: ${existing.length}`);

// Deduplicate and convert
let nextId = existing.length + 1;
const newQuestions = [];

for (const item of rawData) {
    // Normalize for dedup
    const normalizedQ = item.q.replace(/[？?！!。，,\s]/g, '');
    if (existingTexts.has(normalizedQ)) {
        console.log(`  SKIP (dup): ${item.q.substring(0, 30)}...`);
        continue;
    }
    existingTexts.add(normalizedQ);

    // Build options with randomized correct answer position
    const options = [
        { id: 'x', text: item.a, isCorrect: true },
        { id: 'x', text: item.w[0], isCorrect: false },
        { id: 'x', text: item.w[1], isCorrect: false },
    ];
    const shuffled = shuffle(options);
    const ids = ['a', 'b', 'c'];
    shuffled.forEach((opt, i) => { opt.id = ids[i]; });

    newQuestions.push({
        id: nextId++,
        type: classifyType(item.q),
        text: item.q,
        options: shuffled,
    });
}

console.log(`New questions to add: ${newQuestions.length}`);

// Merge and write
const allQuestions = [...existing, ...newQuestions];
writeFileSync(questionsPath, JSON.stringify(allQuestions, null, 2) + '\n', 'utf8');
